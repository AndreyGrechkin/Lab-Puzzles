package com.defey.labpuzzles.repository

import com.defey.labpuzzles.models.FlowFreeCell
import com.defey.labpuzzles.models.FlowFreePosition
import com.defey.labpuzzles.models.FlowFreeState
import com.defey.labpuzzles.models.GameResult
import com.defey.labpuzzles.models.LineContinueResult
import com.defey.labpuzzles.models.LineStartResult

interface FlowFreeEngine {

    // ========================
    // –û–°–ù–û–í–ù–´–ï –û–ü–ï–†–ê–¶–ò–ò –° –õ–ò–ù–ò–Ø–ú–ò
    // ========================

    /**
     * –ù–ê–ß–ê–¢–¨ –ù–û–í–£–Æ –õ–ò–ù–ò–Æ
     *
     * üí° –ü–û–í–ï–î–ï–ù–ò–ï:
     * - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞–∫—Ç–∏–≤–Ω—É—é –ª–∏–Ω–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å)
     * - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–æ–∂–Ω–æ –ª–∏ –Ω–∞—á–∞—Ç—å —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–≤–µ—Ç –ª–∏–Ω–∏–∏ –∏ –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
     *
     * @param state –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
     * @param startPosition –ü–æ–∑–∏—Ü–∏—è –¥–ª—è –Ω–∞—á–∞–ª–∞ –ª–∏–Ω–∏–∏
     * @return –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞—á–∞–ª–∞ –ª–∏–Ω–∏–∏
     */
    fun startNewLine(
        state: FlowFreeState,
        startPosition: FlowFreePosition
    ): LineStartResult

    /**
     * –ü–†–û–î–û–õ–ñ–ò–¢–¨ –ê–ö–¢–ò–í–ù–£–Æ –õ–ò–ù–ò–Æ
     *
     * üí° –ü–û–í–ï–î–ï–ù–ò–ï:
     * - –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é —è—á–µ–π–∫—É –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø—É—Ç–∏
     * - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ö–æ–¥–∞ (—Ü–≤–µ—Ç, —Å–æ—Å–µ–¥—Å—Ç–≤–æ, –∑–∞–Ω—è—Ç–æ—Å—Ç—å)
     * - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏ –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏
     *
     * @param state –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –ª–∏–Ω–∏–∏)
     * @param currentPath –¢–µ–∫—É—â–∏–π –ø—É—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–π –ª–∏–Ω–∏–∏
     * @param newPosition –ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
     * @return –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –ª–∏–Ω–∏–∏
     */
    fun continueLine(
        state: FlowFreeState,
        currentPath: List<FlowFreePosition>,
        newPosition: FlowFreePosition
    ): LineContinueResult

    /**
     * –ó–ê–í–ï–†–®–ò–¢–¨ –õ–ò–ù–ò–Æ –ò –°–û–•–†–ê–ù–ò–¢–¨ –í GRID
     *
     * üí° –ü–û–í–ï–î–ï–ù–ò–ï:
     * - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Å—å –ø—É—Ç—å –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
     * - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–∏–Ω–∏—é –≤ grid (–ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç Empty –≤ Path)
     * - –û—Å—Ç–∞–≤–ª—è–µ—Ç Endpoint —Ç–æ—á–∫–∞–º–∏ (–Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –Ω–∞ Path)
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
     *
     * @param state –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π –ª–∏–Ω–∏–∏)
     * @param path –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π –¥–æ –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏
     * @return –†–µ–∑—É–ª—å—Ç–∞—Ç —Å –Ω–æ–≤—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏–≥—Ä—ã
     */
    fun completeLine(
        state: FlowFreeState,
        path: List<FlowFreePosition>
    ): GameResult<FlowFreeState>

    /**
     * –£–î–ê–õ–ò–¢–¨ –õ–ò–ù–ò–Æ –¶–í–ï–¢–ê
     *
     * üí° –ü–û–í–ï–î–ï–ù–ò–ï:
     * - –£–¥–∞–ª—è–µ—Ç –≤—Å–µ Path —è—á–µ–π–∫–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
     * - –ù–µ —É–¥–∞–ª—è–µ—Ç Endpoint —Ç–æ—á–∫–∏
     * - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–º–µ–Ω—ã –∏–ª–∏ –æ—á–∏—Å—Ç–∫–∏
     *
     * @param state –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
     * @param color –¶–≤–µ—Ç –ª–∏–Ω–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
     * @return –ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ –ª–∏–Ω–∏–∏ —ç—Ç–æ–≥–æ —Ü–≤–µ—Ç–∞
     */
    fun removeLine(
        state: FlowFreeState,
        color: Int
    ): GameResult<FlowFreeState>

    // ========================
    // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´
    // ========================

    /**
     * –ü–†–û–í–ï–†–ò–¢–¨ –£–°–õ–û–í–ò–ï –ü–û–ë–ï–î–´
     *
     * –£—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã:
     * 1. –í—Å–µ —è—á–µ–π–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã (–Ω–µ—Ç Empty)
     * 2. –í—Å–µ Endpoint —Å–æ–µ–¥–∏–Ω–µ–Ω—ã –ª–∏–Ω–∏—è–º–∏ —Å–≤–æ–µ–≥–æ —Ü–≤–µ—Ç–∞
     * 3. –õ–∏–Ω–∏–∏ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è
     *
     * @param state –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
     * @return true –µ—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
     */
    fun checkWinCondition(state: FlowFreeState): Boolean

    /**
     * –ü–†–û–í–ï–†–ò–¢–¨ –í–ê–õ–ò–î–ù–û–°–¢–¨ –ü–û–ó–ò–¶–ò–ò
     *
     * @param state –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
     * @param position –ü–æ–∑–∏—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
     * @return true –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å–µ—Ç–∫–∏
     */
    fun isValidPosition(state: FlowFreeState, position: FlowFreePosition): Boolean

    /**
     * –ü–†–û–í–ï–†–ò–¢–¨ –°–û–°–ï–î–°–¢–í–û –Ø–ß–ï–ï–ö
     *
     * @param pos1 –ü–µ—Ä–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
     * @param pos2 –í—Ç–æ—Ä–∞—è –ø–æ–∑–∏—Ü–∏—è
     * @return true –µ—Å–ª–∏ —è—á–µ–π–∫–∏ —Å–æ—Å–µ–¥–Ω–∏–µ (–≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑/–≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ)
     */
    fun arePositionsAdjacent(pos1: FlowFreePosition, pos2: FlowFreePosition): Boolean

    /**
     * –ü–û–õ–£–ß–ò–¢–¨ –¶–í–ï–¢ –Ø–ß–ï–ô–ö–ò
     *
     * @param state –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
     * @param position –ü–æ–∑–∏—Ü–∏—è —è—á–µ–π–∫–∏
     * @return –¶–≤–µ—Ç —è—á–µ–π–∫–∏ –∏–ª–∏ null –µ—Å–ª–∏ Empty
     */
    fun getCellColor(state: FlowFreeState, position: FlowFreePosition): Int?

    // ========================
    // –£–¢–ò–õ–ò–¢–´ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏)
    // ========================

    /**
     * –ü–†–ï–û–ë–†–ê–ó–û–í–ê–¢–¨ –ü–£–¢–¨ –í GRID
     * (–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥, –º–æ–∂–µ—Ç –±—ã—Ç—å private –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
     */
    fun applyPathToGrid(
        grid: List<List<FlowFreeCell>>,
        path: List<FlowFreePosition>,
        color: Int
    ): List<List<FlowFreeCell>>

    fun hasLineForColor(state: FlowFreeState, color: Int): Boolean
}